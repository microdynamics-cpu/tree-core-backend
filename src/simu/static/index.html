<!doctype html>
<html lang="zh-en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Keyboard Test</title>
    <style>
        * {
            padding: 0;
            padding-top: 10px;
            margin: 0;
            text-align: center;
        }

        #det,
        #jptxt {
            margin-top: 30px;
            width: 500px;
            height: 300px;
            margin: 0 auto;
        }
    </style>
</head>

<body>
    <h1> Keyboard Test</h1>
    <div id="det">pres keyboard</div>
    <canvas id="vga"></canvas>
    <!-- <script src="main.js"></script> -->
    <script src="https://pixijs.download/release/pixi.js"></script>
    <script>
        document.onkeydown = function (even) {
            // console.log('press');
            let jpCode = even.keyCode;
            document.getElementById('det').innerHTML = jpCode;
            let xhr = new XMLHttpRequest();
            xhr.open('POST', 'value', true);
            xhr.setRequestHeader("Content-type", "application/json");
            let obj = {
                "press": 1,
                "params": jpCode,
            };

            xhr.send(JSON.stringify(obj));
        }

        document.onkeyup = function (even) {
            // console.log('key up');
            document.getElementById('det').innerHTML = '0';
            let xhr = new XMLHttpRequest();
            xhr.open('POST', 'value', true);
            xhr.setRequestHeader("Content-type", "application/json");
            let obj = {
                "press": 0,
                "params": 0,
            };
            xhr.send(JSON.stringify(obj));
        }

        // function vga() {
        //     const vga = document.getElementById('vga');
        //     vga.width = window.innerWidth;
        //     vga.height = window.innerHeight;
        //     const gl = vga.getContext('webgl2');
        //     if (!gl) {
        //         return;
        //     }
        //     gl.clearColor(1, 0, 0, 1);
        //     gl.clear(gl.COLOR_BUFFER_BIT);
        // }

        // vga();
        const vga_screen_width = 400;
        const vga_screen_height = 300;
        let app = new PIXI.Application({ width: vga_screen_width, height: vga_screen_height }, { antialias: true });
        document.body.appendChild(app.view);
        let graphics = new PIXI.Graphics();
        app.stage.addChild(graphics);

        function render(color) {
            for (let i = 0; i < vga_screen_width; ++i) {
                for (let j = 0; j < vga_screen_height; ++j) {
                    graphics.beginFill(color);
                    graphics.drawRect(i, j, 1, 1);
                }
            }
            graphics.endFill();
        }

        let col = [0xDE3249, 0xFF0000, 0x00FF00, 0x0000FF];
        let idx = 0;

        for (let i = 0; i < 10; ++i) {
            setTimeout({}, 2000);
            console.log(i);
            // setTimeout(function () {
            //     if (idx == 4) idx = 0;
            //     // render(col[idx]);
            //     ++idx;
            //     console.log(idx);
            // }, 2000);
        }


        // render(col[idx+1]);

    </script>
</body>

</html>